@using System.Web
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Navigations
@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

@using Syncfusion.Blazor.Layouts
@using System.Runtime.InteropServices.JavaScript

<CascadingValue Value="@AppState">
    <div class="page">
        <div>
            <SfToolbar CssClass="defaultToolbar" Height="50px" >
                <ToolbarEvents Clicked="@Toggle"></ToolbarEvents>
                <ToolbarItems>
                    <ToolbarItem PrefixIcon="e-icons e-menu" TooltipText="Menu"></ToolbarItem>
                    <ToolbarItem>
                        <Template>
                            <div class="e-folder">
                                <div class="e-folder-name">Blazor Examples</div>
                            </div>
                        </Template>
                    </ToolbarItem>
                    <ToolbarItem Align="ItemAlign.Right">
                        <Template>
                            <SfButton @onclick="ToggleCode" IconCss="@(_showCode ? "e-icons e-insert-code" : "e-icons e-code-view")" IconPosition=@IconPosition.Right>
                                @(_showCode ? "Hide Code" : "Show Code")
                            </SfButton>
                        </Template>
                    </ToolbarItem>
                </ToolbarItems>
            </SfToolbar>
        </div>
        <div id="wrapper">
            @*Initialize the Sidebar component*@
            @*querymedia isnt't possible when you want to force the sidebar closed in presenting mode*@
            <SfSidebar Width="386px"
                       Target=".main-content"
                       Type="SidebarType.Push"
                       @bind-IsOpen="_sidebarToggle"
                       @attributes=_htmlAttribute
                       OnOpen="OnOpen">
                <ChildContent>
                    <div class="main-menu">
                        <div>
                            <SiteNavigation></SiteNavigation>
                        </div>
                    </div>
                </ChildContent>
            </SfSidebar>
        </div>
        @*main-content declaration*@
        <div class="main-content" id="main-text">
            <div class="sidebar-content">
                <div class="content px-4">
                    @if (_showCode)
                    {
                        <SfSplitter Width="100%" SeparatorSize="3">
                            <SplitterPanes >
                                <SplitterPane size="50%">
                                    <ContentTemplate>
                                        <CodeViewer Uri="@NavigationManager.GetUriWithQueryParameter("presenting", (bool?)null)" BaseUri="@NavigationManager.BaseUri"></CodeViewer>
                                    </ContentTemplate>
                                </SplitterPane>
                                <SplitterPane>
                                    <ContentTemplate >
                                        @Body
                                    </ContentTemplate>
                                </SplitterPane>
                            </SplitterPanes>
                        </SfSplitter>
                    }
                    else
                    {
                        @Body
                    }
                </div>

            </div>

        </div>
    </div>
</CascadingValue>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

@code
{
    [SupplyParameterFromQuery]
    public bool presenting { get; set; }
    
    bool _showCode = true;
    string _codeFileUri = "";
    // Specify the value of Sidebar component state. It indicates whether the sidebar component is in an open/close state.
    bool _sidebarToggle = true;
    readonly Dictionary<string, object> _htmlAttribute = new()
    {
        { "class", "sidebar-treeview" }
    };
    
    //possible bool for presentation mode
    //private bool _showNav = true;
    
    //make sure that AppState is initialized
    private AppState AppState { get; } = new();
    
    
    protected override void OnInitialized()
    {
        if (presenting) _sidebarToggle = false;
        /*NavigationManager.LocationChanged += LocationChanged;*/
        // _codeFileUri = SiteNavigationHelper.GetFileUrl(NavigationManager.Uri, NavigationManager.BaseUri);
    }
    void OnOpen()
    {
        if (presenting) _sidebarToggle = false;
    }
    /*private void LocationChanged(object? sender, LocationChangedEventArgs e)
    {
        _codeFileUri = SiteNavigationHelper.GetFileUrl(NavigationManager.Uri, NavigationManager.BaseUri);
    }*/
    
    // Specifies the event handler for Clicked event in the menu button component.
    void Toggle(ClickEventArgs args)
    {
        if (args.Item.TooltipText == "Menu")
        {
            _sidebarToggle = !_sidebarToggle;
            
        }
    }
    
    //specifies the event handler for the click event in the Code button component
    void ToggleCode()
    {
        _showCode = !_showCode;
        //_codeFileUri= SiteNavigationHelper.GetFileUrl(NavigationManager.Uri, NavigationManager.BaseUri);
    }
}

@*Some silly css styling to override button focus and still keep original styling*@
@*And then we need to override hover since focus takes precedence SIGH!!! :P *@
@*TODO: fix with javascript. remove focus on click*@

<style>
    .e-toolbar .e-toolbar-item .e-tbar-btn:focus {
        background: #f8f9fa;
        box-shadow: none;
        border: none;
        }
    .e-toolbar .e-toolbar-item .e-tbar-btn:hover{  
             background: #5c636a !important;
             border-color: #6c757d !important;
             border-style: solid !important;
             border-width: 0 !important;
             border-radius: 4px !important;
             color: #6c757d;
    }
</style>
       
 
